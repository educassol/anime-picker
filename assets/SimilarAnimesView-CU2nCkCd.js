import{_ as C,r as m,b as F,j as p,w as V,c as i,d as s,e as c,f as D,v as M,F as b,h as E,t as o,o as l}from"./index-3kt9WIP0.js";import{F as $}from"./fuse-DPyu62bB.js";const H={class:"anime-search-view"},j={class:"search-container"},I={class:"search-box"},P={key:0,class:"suggestions"},U=["onClick"],O=["src"],Q={class:"suggestion-info"},Y={class:"title"},q={key:0,class:"english-title"},z={class:"score"},G={key:0,class:"loading-more"},J={key:0,class:"loading"},K={key:1,class:"selected-anime"},W={key:0,class:"similar-animes"},X={class:"similar-grid"},Z=["href"],ee=["src"],se={class:"similar-info"},te={key:0,class:"synopsis"},ae={class:"anime-details"},ie={class:"detail-item"},le={class:"detail-item"},ne={key:2,class:"loading"},oe={key:3,class:"error-message"},re=500,ce={__name:"SimilarAnimesView",setup(de){const u=m(""),g=m([]),h=m([]),y=m(null),f=m([]),r=m({initial:!0,more:!1,apiSearch:!1,details:!1}),_=m(null);let A=null,k=1,w=null;F(async()=>{try{await S(),N()}catch{_.value="Error loading starter list"}finally{r.value.initial=!1}});const S=async()=>{try{r.value.more=!0;const a=await p.getTopAnimes(k);g.value=[...g.value,...a.data.data],k++,N()}finally{r.value.more=!1}},N=()=>{A=new $(g.value,{keys:["title","title_english","title_synonyms"],threshold:.3,minMatchCharLength:2,ignoreLocation:!0})},T=async()=>{try{if(!A)return;const a=A.search(u.value).slice(0,20).map(({item:n})=>n);if(a.length<5&&u.value.length>2){r.value.apiSearch=!0;const e=(await p.searchAnime(u.value)).data.data.filter(d=>!g.value.some(t=>t.mal_id===d.mal_id)).slice(0,5);h.value=[...a,...e]}else h.value=a}catch{_.value="Search error"}finally{r.value.apiSearch=!1}},L=a=>{u.value="",y.value=a,R(a)},R=async a=>{try{r.value.details=!0,_.value=null;const e=(await p.getAnimeRecommendations(a.mal_id)).data.data.filter(t=>t.entry).slice(0,12),d=[];for(const t of e)try{const v=await p.getAnimeById(t.entry.mal_id);d.push({id:t.entry.mal_id,title:t.entry.title,image:t.entry.images.webp.image_url,score:v.data.data.score||"N/A",episodes:v.data.data.episodes,year:v.data.data.year,synopsis:v.data.data.synopsis,votes:t.votes,url:`https://myanimelist.net/anime/${t.entry.mal_id}`}),await new Promise(B=>setTimeout(B,100))}catch(v){console.error(`Erro no anime ${t.entry.mal_id}:`,v),d.push({id:t.entry.mal_id,title:t.entry.title,image:t.entry.images.webp.image_url,score:"N/A",episodes:"N/A",year:"N/A",synopsis:null,votes:t.votes,url:`https://myanimelist.net/anime/${t.entry.mal_id}`})}f.value=d}catch(n){_.value="Error finding similar animes: "+n.message}finally{r.value.details=!1}},x=a=>{const{scrollTop:n,scrollHeight:e,clientHeight:d}=a.target;e-n<=d+100&&S()};return V(()=>{clearTimeout(w),u.value?w=setTimeout(T,re):h.value=[]}),(a,n)=>(l(),i("div",H,[s("div",j,[s("div",I,[D(s("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>u.value=e),placeholder:"Search an anime...",class:"search-input",onScrollPassive:x},null,544),[[M,u.value]]),h.value.length?(l(),i("div",P,[(l(!0),i(b,null,E(h.value,e=>(l(),i("div",{key:e.mal_id,class:"suggestion-item",onClick:d=>L(e)},[s("img",{src:e.images.webp.small_image_url,class:"suggestion-image"},null,8,O),s("div",Q,[s("div",Y,o(e.title),1),e.title_english?(l(),i("div",q,o(e.title_english),1)):c("",!0),s("div",z,"⭐ "+o(e.score||"N/A"),1)])],8,U))),128)),r.value.apiSearch?(l(),i("div",G," Searching... ")):c("",!0)])):c("",!0)]),r.value.details?(l(),i("div",J,n[1]||(n[1]=[s("div",{class:"progress"},"Searching, please wait...",-1)]))):c("",!0),y.value?(l(),i("div",K,[f.value.length?(l(),i("div",W,[s("h3",null,"Similar animes to: "+o(y.value.title),1),s("div",X,[(l(!0),i(b,null,E(f.value,e=>(l(),i("a",{key:e.id,href:e.url,target:"_blank",class:"similar-card"},[s("img",{src:e.image,class:"similar-image"},null,8,ee),s("div",se,[s("h3",null,o(e.title),1),e.synopsis?(l(),i("p",te,o(e.synopsis.substring(0,100))+"... ",1)):c("",!0),s("div",ae,[s("div",ie,[s("span",null,"⭐ "+o(e.score||"N/A"),1),s("span",null,"🎬 "+o(e.episodes||"N/A")+" eps",1)]),s("div",le,[s("span",null,"👍 "+o(e.votes)+" votes",1),s("span",null,"📅 "+o(e.year||"N/A"),1)])])])],8,Z))),128))])])):c("",!0)])):c("",!0),r.value.details?(l(),i("div",ne," Loading details... ")):c("",!0),_.value?(l(),i("div",oe,o(_.value),1)):c("",!0)])]))}},_e=C(ce,[["__scopeId","data-v-1e593679"]]);export{_e as default};
