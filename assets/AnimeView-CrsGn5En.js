import{_ as T,r,b as V,j as E,w as B,c as n,d as e,e as L,f as D,v as M,g as R,F as x,h as P,t,o}from"./index-DtloGqDA.js";import{F as $}from"./fuse-DPyu62bB.js";const j={class:"anime-search-view"},K={class:"search-container"},U={class:"search-box"},H={key:0,class:"suggestions"},I=["onClick"],O=["src"],Q={class:"suggestion-info"},Y={class:"title"},q={class:"score"},z={key:0,class:"error-message"},G={key:1,class:"loading"},J={key:2,class:"similar-grid"},W=["href"],X=["src"],Z={class:"similar-info"},ee={class:"synopsis"},se={class:"anime-details"},ae={class:"detail-item"},te={class:"detail-item"},le={class:"pagination"},ie=["disabled"],ne={class:"page-number"},oe=["disabled"],ce=500,re={__name:"AnimeView",setup(ue){const c=r(""),v=r([]),_=r([]),g=r([]),p=r(1),l=r({initial:!0,search:!1,more:!1}),m=r(null),h=r(24);let b=null,k=1,w=null;V(async()=>{try{await A(),S()}catch{m.value="Error loading initial data"}finally{l.value.initial=!1}});const S=()=>{b=new $(v.value,{keys:["title","title_english","title_synonyms"],threshold:.3,minMatchCharLength:2,ignoreLocation:!0})},A=async()=>{try{l.value.more=!0;const a=await E.getTopAnimes(k,h.value);v.value=[...v.value,...a.data.data],g.value=v.value.slice(0,h.value),k++}catch{m.value="Error loading more animes"}finally{l.value.more=!1}},f=async()=>{try{l.value.search=!0;const a=b.search(c.value).slice(0,h.value).map(({item:i})=>i);if(a.length<h.value&&c.value.length>2){const s=(await E.searchAnimes(c.value,p.value,h.value)).data.data.filter(u=>!v.value.some(d=>d.mal_id===u.mal_id));_.value=[...a,...s].slice(0,5)}else _.value=a.slice(0,5)}catch{m.value="Search error"}finally{l.value.search=!1}},F=a=>{c.value=a.title,g.value=[a],_.value=[]},N=a=>{p.value+=a,c.value?f():A()};return B(()=>{clearTimeout(w),c.value?w=setTimeout(f,ce):(g.value=v.value.slice(0,h.value),_.value=[])}),(a,i)=>(o(),n("div",j,[e("div",K,[e("div",U,[D(e("input",{"onUpdate:modelValue":i[0]||(i[0]=s=>c.value=s),placeholder:"Search anime...",class:"search-input",onKeyup:R(f,["enter"])},null,544),[[M,c.value]]),_.value.length?(o(),n("div",H,[(o(!0),n(x,null,P(_.value,s=>{var u,d;return o(),n("div",{key:s.mal_id,class:"suggestion-item",onClick:y=>F(s)},[e("img",{src:(d=(u=s.images)==null?void 0:u.webp)==null?void 0:d.small_image_url,class:"suggestion-image"},null,8,O),e("div",Q,[e("div",Y,t(s.title),1),e("div",q,"⭐ "+t(s.score||"N/A"),1)])],8,I)}),128))])):L("",!0)])]),m.value?(o(),n("div",z,t(m.value),1)):L("",!0),l.value.initial||l.value.search?(o(),n("div",G,t(l.value.initial?"Loading...":"Searching..."),1)):(o(),n("div",J,[(o(!0),n(x,null,P(g.value,s=>{var u,d,y,C;return o(),n("a",{key:s.mal_id,href:`https://myanimelist.net/anime/${s.mal_id}`,target:"_blank",class:"similar-card"},[e("img",{src:((d=(u=s.images)==null?void 0:u.webp)==null?void 0:d.large_image_url)||"/placeholder.jpg",class:"similar-image"},null,8,X),e("div",Z,[e("h3",null,t(s.title),1),e("p",ee,t((y=s.synopsis)==null?void 0:y.substring(0,100))+"...",1),e("div",se,[e("div",ae,[e("span",null,"⭐ "+t(s.score||"N/A"),1),e("span",null,"🎬 "+t(s.episodes||"N/A")+" eps",1)]),e("div",te,[e("span",null,"📅 "+t(s.year||"N/A"),1),e("span",null,"👥 "+t(((C=s.members)==null?void 0:C.toLocaleString())||"N/A"),1)])])])],8,W)}),128))])),e("div",le,[e("button",{onClick:i[1]||(i[1]=s=>N(-1)),disabled:p.value===1||l.value.more,class:"pagination-button"}," Previous ",8,ie),e("span",ne,"Page "+t(p.value),1),e("button",{onClick:i[2]||(i[2]=s=>N(1)),disabled:l.value.more,class:"pagination-button"}," Next ",8,oe)])]))}},_e=T(re,[["__scopeId","data-v-f627b18f"]]);export{_e as default};
